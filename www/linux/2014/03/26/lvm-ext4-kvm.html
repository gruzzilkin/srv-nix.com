<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="zrEDTiP0xgJYfIhexhD8C_CBtEQQrJa1fnOmXrzyhVM" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>LVM+KVM+EXT4, изменение размера виртуального диска с собственной таблицей разделов</title>
    <meta name="viewport" content="width=device-width">
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
<div class="b-canvas">
    <nav class="b-menu b-menu_type_inline b-menu_viewtype_square-brackets">
        <ul class="b-menu__list">
            <li class="b-menu__item"><a href="/" class="b-menu__item-text b-link"><span class="b-link__text">SRV-NIX.COM</span></a></li>
            <li class="b-menu__item"><a href="http://srv-nix.com/tags.html" class="b-menu__item-text b-link"><span class="b-link__text">Tags</span></a></li>
            <li class="b-menu__item"><a href="https://www.google.ru/search?q=google.com&oq=google.com&#newwindow=1&q=site:srv-nix.com" target="_blank" class="b-menu__item-text b-link"><span class="b-link__text">Search</span></a></li>
        </ul>
    </nav>

  <article class="b-document">
      <header class="b-document-header">
    <div class="b-document-header__section">
        Authtor:<br/>
        Posted at:<br/>
    </div>
    <div class="b-document-header__section">
        A. Semenov<br/>
        26 Mar 2014<br/>
    </div>
</header>
<dl class="b-document-section">
    <dt class="b-document-section__title">
        NAME
    </dt>
    <dd class="b-document-section__body b-pure-content">
                <h1>LVM+KVM+EXT4, изменение размера виртуального диска с собственной таблицей разделов</h1>
    </dd>
</dl>
<dl class="b-document-section">
    <dt class="b-document-section__title">
        Description
    </dt>
    <dd class="b-document-section__body b-pure-content">
        <div class="b-document-body">
            <div class="b-pure-content">
                <section>
                    <p>Нам понадобятся: lvm2, kpartx, cfdisk, e2fsck
&lt;!--more--&gt;
Выключаем VPS на которой используется раздел LVM.
Увеличиваем сам том:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># lvextend -L +2G /dev/mapper/vms-vps--test</span>
<span class="s1">&#39;+2G&#39;</span> - размер на который увеличиваем диск
</code></pre></div>

<p>Теперь открываем раздел и пересоздаём таблицу разделов.</p>

<div class="highlight"><pre><code class="bash"><span class="c"># cfdisk /dev/mapper/vms-fms--test                                                                                                                   </span>
</code></pre></div>

<p>Чтобы открыть нужные разделы, я воспользовался утилитой kpartx:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># kpartx -a /dev/mapper/vms-vps--test</span>
</code></pre></div>

<p>После чего в системе появится нужный нам раздел &#39;/dev/mapper/vms-vps--test1&#39;
Проверяем раздел:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># e2fsck -f /dev/mapper/vms-vps--test1                                                                                                               </span>
e2fsck 1.41.12 <span class="o">(</span>17-May-2010<span class="o">)</span>
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/mapper/vms-fms--test1: 13/576000 files <span class="o">(</span>0.0% non-contiguous<span class="o">)</span>, 1889245/2340856 blocks
</code></pre></div>

<p>Обновляем информацию о новом размере ФС:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># resize2fs -p /dev/mapper/vms-vps--test1                                                                                                            </span>
resize2fs 1.41.12 <span class="o">(</span>17-May-2010<span class="o">)</span>
Resizing the filesystem on /dev/mapper/vms-vps--test1 to 2865144 <span class="o">(</span>4k<span class="o">)</span> blocks.
Begin pass 1 <span class="o">(</span><span class="nv">max</span> <span class="o">=</span> 16<span class="o">)</span>
Extending the inode table     XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
The filesystem on /dev/mapper/vms-vps--test1 is now 2865144 blocks long.
</code></pre></div>

<p>Отключаем чтение таблицы разделов:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># kpartx -d /dev/mapper/vms-vps--test</span>
</code></pre></div>

<p>Проверяем результат:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># lvs</span>
</code></pre></div>

<p>После чего запускаем виртуальную машину, раздел должен быть увеличенным на указанное число.
Всй!</p>

                </section>
            </div>
        </div>
    </dd>
</dl>
<footer class="b-footer">
    <div class="b-footer__row">
        <div class="b-footer__section b-footer__section_type_left">
            wilful.su
        </div>
        <div class="b-footer__section b-footer__section_type_center">
            <a href="http://jabber.srv-nix.com/linux/2014/03/26/lvm-ext4-kvm.html" target="_blank">Join the discussion</a>
        </div>
        <div class="b-footer__section b-footer__section_type_right">
            <a href=/linux/2014/03/26/lvm-ext4-kvm.html>&#5123</a>
        </div>
    </div>
    <div class="b-footer__row">
        <div class="b-footer__section b-footer__section_type_left">
        </div>
        <div class="b-footer__section b-footer__section_type_center">
            <a href="/tags/linux.html" rel="tag">linux</a>, <a href="/tags/lvm.html" rel="tag">lvm</a>, <a href="/tags/kvm.html" rel="tag">kvm</a>, <a href="/tags/fs.html" rel="tag">fs</a>, <a href="/tags/ext4.html" rel="tag">ext4</a>
        </div>
        <div class="b-footer__section b-footer__section_type_right">
        </div>
    </div>
</footer>

  </article>

</div>
</body>
</html>

