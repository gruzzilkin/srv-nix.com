<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="zrEDTiP0xgJYfIhexhD8C_CBtEQQrJa1fnOmXrzyhVM" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Скрипты на все случаи жизни</title>
    <meta name="viewport" content="width=device-width">
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
<div class="b-canvas">
    <nav class="b-menu b-menu_type_inline b-menu_viewtype_square-brackets">
        <ul class="b-menu__list">
            <li class="b-menu__item"><a href="/" class="b-menu__item-text b-link"><span class="b-link__text">SRV-NIX.COM</span></a></li>
            <li class="b-menu__item"><a href="http://srv-nix.com/tags.html" class="b-menu__item-text b-link"><span class="b-link__text">Tags</span></a></li>
            <li class="b-menu__item"><a href="https://www.google.ru/search?q=google.com&oq=google.com&#newwindow=1&q=site:srv-nix.com" target="_blank" class="b-menu__item-text b-link"><span class="b-link__text">Search</span></a></li>
        </ul>
    </nav>

  <article class="b-document">
      <header class="b-document-header">
    <div class="b-document-header__section">
        Authtor:<br/>
        Posted at:<br/>
    </div>
    <div class="b-document-header__section">
        A. Semenov<br/>
        25 Feb 2014<br/>
    </div>
</header>
<dl class="b-document-section">
    <dt class="b-document-section__title">
        NAME
    </dt>
    <dd class="b-document-section__body b-pure-content">
                <h1>Скрипты на все случаи жизни</h1>
    </dd>
</dl>
<dl class="b-document-section">
    <dt class="b-document-section__title">
        Description
    </dt>
    <dd class="b-document-section__body b-pure-content">
        <div class="b-document-body">
            <div class="b-pure-content">
                <section>
                    <p>Хотел просто сделать коллекцию скриптов, которые приходится писать довольно часто, а получился модульный фреймворк для работы с любыми скриптами. В базовый функционал вынесены только функции для работы с логированием, навешиванием lock-файла при необходимости, почтовые рассылки, функции для работы с выводом и прочее.</p>

<!--more-->

<p>Сам фреймворк можно найти <a href="https://github.com/wilful/root-shell">тут</a>.</p>

<p>Как это работает</p>

<p>Для работы скрипта необходимо скопировать (или слинковать) файл конфигурации:</p>

<div class="highlight"><pre><code class="bash">ln -s <span class="k">${</span><span class="nv">script_root</span><span class="k">}</span>/usr/share/rc.conf.example <span class="k">${</span><span class="nv">script_root</span><span class="k">}</span>/etc/rc.conf
</code></pre></div>

<p>После чего можно запустить скрипт без параметров:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>bash <span class="k">${</span><span class="nv">script_root</span><span class="k">}</span>/bin/wilshell.sh 
<span class="o">==[</span> Debug inf. <span class="o">]==</span>  
    2012-11-28_02-44 <span class="o">[</span>LogLevel <span class="nb">set </span>1<span class="o">]</span> <span class="o">[</span>Usage simple<span class="o">]</span>
<span class="o">==[</span> Usage <span class="o">]==</span>   
    <span class="nv">lock</span>     <span class="o">==</span>&gt; Module to lock the script
    <span class="nv">cleaner</span>  <span class="o">==</span>&gt; The module <span class="k">for </span>cleaning old files
    <span class="nv">backup</span>   <span class="o">==</span>&gt; Backup files and directories
    <span class="nv">mysql</span>    <span class="o">==</span>&gt; Create a backup of the database
    <span class="nv">dumpsys</span>  <span class="o">==</span>&gt; Dump system state
    <span class="nv">sender</span>   <span class="o">==</span>&gt; Module to send files to a remote server
    <span class="nv">iptables</span>     <span class="o">==</span>&gt; Module to control iptables
    <span class="nv">ldap</span>     <span class="o">==</span>&gt; The backup database server openldap
    <span class="nv">rpmbuild</span>     <span class="o">==</span>&gt; RPM collector packages
    <span class="nv">misc</span>     <span class="o">==</span>&gt; Other Features
</code></pre></div>

<p>Это не полный список модулей, здесь перечислены модули из массива в файле конфигурации. Полный список модулей можно просмотреть в папке:</p>

<div class="highlight"><pre><code class="bash">ls -l <span class="k">${</span><span class="nv">script_root</span><span class="k">}</span>/usr/modules
</code></pre></div>

<p>Для отображения списка параметров модуля достаточно запустить его без параметров, например:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>bash <span class="k">${</span><span class="nv">script_root</span><span class="k">}</span>/bin/wilshell.sh <span class="nv">backup</span>
<span class="o">==[</span> Debug inf. <span class="o">]==</span>  
    2012-11-28_02-48 <span class="o">[</span>LogLevel <span class="nb">set </span>1<span class="o">]</span> <span class="o">[</span>Usage simple<span class="o">]</span>
<span class="o">==[</span> Usage <span class="o">]==</span>   
&gt; -b  Путь к директории содержащей бэкапы <span class="o">[</span>/tmp/backup<span class="o">]</span>
&gt; -d  Удалять бэкапы старше чем, указанное количество дней <span class="o">[</span>3<span class="o">]</span>
&gt; -l  Список папок для бэкапа <span class="o">[</span>fileset.conf<span class="o">]</span>
&gt; -c  Директория с файлсетами для бэкапа <span class="o">[</span>../etc/fileset.d/<span class="o">]</span>
&gt; -r  Запустить бэкап
&gt; -v  Режим отладки
</code></pre></div>

<p>Некоторые модули сейчас нуждаются в рефакторинге, некоторые еще не полностью дописаны, поскольку большое внимание уделялось самому &quot;движку&quot;, бОльшая часть функционала которого описана в  отдельной библиотеке.</p>

                </section>
            </div>
        </div>
    </dd>
</dl>
<footer class="b-footer">
    <div class="b-footer__row">
        <div class="b-footer__section b-footer__section_type_left">
            wilful.su
        </div>
        <div class="b-footer__section b-footer__section_type_center">
            Tags
        </div>
        <div class="b-footer__section b-footer__section_type_right">
            <a href=/linux/2014/02/25/bash-scripts-help.html>&#5123</a>
        </div>
    </div>
    <div class="b-footer__row">
        <div class="b-footer__section b-footer__section_type_left">
        </div>
        <div class="b-footer__section b-footer__section_type_center">
            <a href="/tags/help.html" rel="tag">help</a>, <a href="/tags/howto.html" rel="tag">howto</a>, <a href="/tags/bash.html" rel="tag">bash</a>
        </div>
        <div class="b-footer__section b-footer__section_type_right">
        </div>
    </div>
</footer>

  </article>

</div>
</body>
</html>

